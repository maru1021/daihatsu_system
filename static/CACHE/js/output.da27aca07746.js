let isInitialized=false;function initializeImageUpload(){if(isInitialized)return;document.addEventListener('shown.bs.modal',function(event){const modal=event.target;if(!modal.id||(!modal.id.includes('RegisterModal')&&!modal.id.includes('EditModal'))){return;}
const imageUploadArea=modal.querySelector('.image-upload-area');const fileInput=modal.querySelector('.image-input');const imagePreview=modal.querySelector('.image-preview');const previewImage=modal.querySelector('.previewImage');const removeImageBtn=modal.querySelector('.removeImage');const changeImageBtn=modal.querySelector('.changeImage');if(!imageUploadArea||!fileInput)return;const newImageUploadArea=imageUploadArea.cloneNode(true);imageUploadArea.parentNode.replaceChild(newImageUploadArea,imageUploadArea);const newFileInput=fileInput.cloneNode(true);fileInput.parentNode.replaceChild(newFileInput,fileInput);const newPreviewImage=previewImage.cloneNode(true);previewImage.parentNode.replaceChild(newPreviewImage,previewImage);const newRemoveImageBtn=removeImageBtn.cloneNode(true);removeImageBtn.parentNode.replaceChild(newRemoveImageBtn,removeImageBtn);const newChangeImageBtn=changeImageBtn.cloneNode(true);changeImageBtn.parentNode.replaceChild(newChangeImageBtn,changeImageBtn);const updatedImageUploadArea=modal.querySelector('.image-upload-area');const updatedFileInput=modal.querySelector('.image-input');const updatedPreviewImage=modal.querySelector('.previewImage');const updatedRemoveImageBtn=modal.querySelector('.removeImage');const updatedChangeImageBtn=modal.querySelector('.changeImage');updatedImageUploadArea.addEventListener('click',function(e){if(e.target!==updatedFileInput){updatedFileInput.click();}});updatedFileInput.addEventListener('change',function(e){const file=e.target.files[0];if(file&&file.type.startsWith('image/')){displayImagePreview(file);}});updatedImageUploadArea.addEventListener('dragover',function(e){e.preventDefault();updatedImageUploadArea.classList.add('dragover');});updatedImageUploadArea.addEventListener('dragleave',function(e){e.preventDefault();updatedImageUploadArea.classList.remove('dragover');});updatedImageUploadArea.addEventListener('drop',function(e){e.preventDefault();updatedImageUploadArea.classList.remove('dragover');const files=e.dataTransfer.files;if(files.length>0){const file=files[0];if(file.type.startsWith('image/')){updatedFileInput.files=files;displayImagePreview(file);}else{showToast('error','画像ファイルを選択してください');}}});function displayImagePreview(file){const reader=new FileReader();reader.onload=function(e){updatedPreviewImage.src=e.target.result;imagePreview.style.display='block';updatedImageUploadArea.style.display='none';};reader.readAsDataURL(file);}
updatedChangeImageBtn.addEventListener('click',function(){updatedFileInput.click();});updatedPreviewImage.addEventListener('click',function(){if(updatedPreviewImage.src){const imageModal=document.getElementById('imageModal');const modalImage=document.getElementById('modalImage');if(imageModal&&modalImage){modalImage.src=updatedPreviewImage.src;const modal=new bootstrap.Modal(imageModal);modal.show();}}});updatedRemoveImageBtn.addEventListener('click',function(){updatedFileInput.value='';imagePreview.style.display='none';updatedImageUploadArea.style.display='block';updatedPreviewImage.src='';});});isInitialized=true;};